<!DOCTYPE html>
<html lang="en-GB">
<head>
<title>Automate</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" type="text/css" href="../css/endmedia.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/vue/control.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/lib/jquery.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/lib/vue.global.prod.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/common/builtin.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/common/global.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/client/music.js" charset="utf-8"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/client/shortcuts.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/orychung/endfw@0.4.1/client/quick_vue.js"></script>
<script type="text/javascript" id="method">
Object.assign(Vue.endAddOn.commonMethods, {
  async testInit() {
    await http.get('/dev/loadDynamic');
    await http.get('/metadata/init');
  },
});
</script>
<script type="text/javascript" id="main">
async function initPage() {
  g.ui = {
    themeFaceHue: 120,
  };
  globalThis.all = g;

  await Vue.endAddOn.loadTemplateURLs('https://cdn.jsdelivr.net/gh/orychung/endfw@0.4/vue/control.xml');
  Vue.endAddOn.templates = Vue.endAddOn.templates.concat(Array.from($('vueTemplate')));
  Vue.endAddOn.createApp({
    mountSelectors: ['#screen'],
  });

  initData();
}

async function initData() {
  let libraryList = await http.get('/metadata/listLibrary');
  g.libraries = {};
  for await (const x of libraryList.map(async x=>[x,await http.post('/metadata/listFiles', {library: x})])) {
    g.libraries[x[0]] = {
      path: x[0],
      files: x[1].data,
    };
  }
  
  basicTest();
}

async function basicTest() {
  let library = Object.keys(g.libraries)[0];
  console.log('readFile', await http.post('/mediaFile/readFile', {
    library: library,
    path: '[m3u]/2-years.m3u8',
  }));
  console.log('readdir', await http.post('/mediaFile/readdir', {
    library: library,
    path: '[m3u]',
  }));
}

</script>
</head>
<vueTemplates>
</vueTemplates>
<body onload="initPage()">
<div id="screen" class="flex-row flex-stretch full-size">
  <flex-layout class="col vscroll tool">
    <button @click="testInit">Re-Init</button>
  </flex-layout>
  <flex-layout class="col vscroll flex-remain">
  </flex-layout>
  <screen-layer style="--base-z-index:20;">
    <t-cover :all="all"></t-cover>
    <t-contextmenu :all="all" :w="all.ui.contextmenus"></t-contextmenu>
  </screen-layer>
</div>
</body>
</html>
